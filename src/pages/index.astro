---
import Layout from '../layouts/Layout.astro';
import AuthGuard from '../components/AuthGuard.astro';
import StatsDashboard from '../components/StatsDashboard.astro';
import Calendar from '../components/Calendar.astro';
import ActivityModal from '../components/ActivityModal.astro';
import NavMenu from '../components/NavMenu.astro';
import StatisticsView from '../components/StatisticsView.astro';
---

<Layout title="Patagonia Tracker">
    <AuthGuard>
        <div class="app-container">
            <!-- HEADER -->
            <header class="app-header">
                <!-- NAV MENU (Left) -->
                <NavMenu />

                <!-- CENTER LOGO -->
                <div class="logo-area">
                    <div class="brand-title">
                        <span class="brand-main">PATAGONIA</span>
                        <span class="brand-orange">TRACKER</span>
                    </div>
                </div>
                
                <!-- Spacer for balance or tiny profile icon? -->
                <div style="width: 28px;"></div> 
            </header>
    
            <!-- VIEWS CONTAINER -->
            <div id="views-wrapper">
                
                <!-- VIEW: HOME -->
                <div id="view-home" class="view-section">
                    <StatsDashboard />
                    <main>
                        <Calendar />
                    </main>
                </div>

                <!-- VIEW: STATS -->
                <div id="view-stats" class="view-section hidden">
                    <StatisticsView />
                </div>

            </div>
            
            <ActivityModal />
        </div>
    </AuthGuard>
</Layout>

<script>
    import { currentView } from '../stores/uiStore';

    const vHome = document.getElementById('view-home');
    const vStats = document.getElementById('view-stats');
    const viewsWrapper = document.getElementById('views-wrapper');
    
    // We need to track previous view to know direction
    let lastView = 'home';

    currentView.subscribe(view => {
        if(view === lastView) return;

        // Determine Direction
        // Home -> Stats : Slide Left (Home exits Left, Stats enters from Right)
        // Stats -> Home : Slide Right (Stats exits Right, Home enters from Left)
        
        if(view === 'stats') {
            // GOING TO STATS
            vHome.classList.remove('active');
            vHome.classList.add('slide-out-left');
            
            vStats.classList.remove('hidden'); // Make visible first
            vStats.classList.add('active');
            vStats.classList.add('slide-in-right');
            
            // Cleanup classes after anim
            setTimeout(() => {
                vHome.classList.add('hidden');
                vHome.classList.remove('slide-out-left');
                vStats.classList.remove('slide-in-right');
            }, 300);

        } else if(view === 'home') {
            // GOING TO HOME
            vStats.classList.remove('active');
            vStats.classList.add('slide-out-right');

            vHome.classList.remove('hidden');
            vHome.classList.add('active');
            vHome.classList.add('slide-in-left');

            setTimeout(() => {
                vStats.classList.add('hidden');
                vStats.classList.remove('slide-out-right');
                vHome.classList.remove('slide-in-left');
            }, 300);
        }

        lastView = view;
    });
</script>

<style>
    .app-container {
        max-width: 600px;
        margin: 0 auto;
        min-height: 100vh;
        background: var(--bg-main);
        box-shadow: 0 0 50px var(--shadow);
        overflow-x: hidden;
        position: relative;
    }

    .app-header {
        display: flex; justify-content: space-between; align-items: center;
        padding: 15px 20px;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(12px); 
        -webkit-backdrop-filter: blur(12px);
        position: sticky; top: 0; z-index: 50;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .logo-area { display: flex; align-items: center; gap: 8px; text-align: center; }
    
    .brand-title { display: flex; flex-direction: column; line-height: 0.9; align-items: center; }
    .brand-main {
        font-family: var(--font-head); color: var(--text-main); font-size: 1.1rem; letter-spacing: 0.5px;
    }
    .brand-orange {
        font-family: var(--font-head); color: var(--primary); font-size: 1.1rem; letter-spacing: 0.5px;
        text-shadow: 0 0 10px rgba(234, 88, 12, 0.4);
    }

    #views-wrapper {
        position: relative;
        width: 100%;
    }

    .view-section {
        width: 100%;
        transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.3s ease;
        position: relative;
    }
    
    .view-section.hidden {
        display: none;
    }

    .slide-in-right { animation: slideInRight 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    .slide-out-left { animation: slideOutLeft 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; display: block !important; position: absolute; top:0; left:0; width:100%; }

    .slide-in-left { animation: slideInLeft 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    .slide-out-right { animation: slideOutRight 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; display: block !important; position: absolute; top:0; left:0; width:100%; }

    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes slideOutLeft { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-20%); opacity: 0; } }

    @keyframes slideInLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(20%); opacity: 0; } }

</style>
