<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PATAGONIA 2026 | DASHBOARD</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22%23FF5722%22><path d=%22M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z%22/></svg>">

    <style>
        :root {
            /* UX COLORS */
            --primary: #FF3D00; /* Naranja más agresivo */
            --bg-main: #050505;
            --bg-surface: #141414;
            --bg-card: #1E1E1E;
            --text-main: #E0E0E0;
            --text-muted: #757575;
            --success: #00E676; /* Verde neón para feedback positivo */
            --danger: #FF1744;
            
            /* UI VARIABLES */
            --radius: 12px;
            --header-h: 160px;
            --font-display: 'Montserrat', sans-serif;
            --font-data: 'JetBrains Mono', monospace; /* Para datos, monoespaciada es mejor */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0;
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: var(--font-display);
            overflow-x: hidden;
            height: 100%;
        }

        /* --- UI: GLASS HEADER --- */
        .sticky-wrapper {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 15px 20px 10px 20px;
            padding-top: env(safe-area-inset-top, 20px);
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .brand { display: flex; align-items: center; gap: 10px; }
        .brand svg { width: 28px; fill: var(--primary); }
        .brand h1 { font-size: 1.2rem; font-weight: 800; letter-spacing: -0.5px; margin: 0; }
        .brand span { color: var(--primary); }
        
        .settings-btn svg { width: 22px; fill: var(--text-muted); transition: 0.3s; }
        .settings-btn:active svg { fill: var(--text-main); transform: rotate(90deg); }

        /* --- UX: DATA VISUALIZATION --- */
        .progress-container { margin-bottom: 15px; }
        .progress-labels { display: flex; justify-content: space-between; font-family: var(--font-data); font-size: 0.7rem; color: var(--text-muted); margin-bottom: 5px; }
        .progress-bar-bg { width: 100%; height: 6px; background: #333; border-radius: 10px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 1s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 10px rgba(255, 61, 0, 0.5); }

        .stats-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .stat-item { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; text-align: center; }
        .stat-label { font-size: 0.6rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-family: var(--font-data); font-size: 1rem; font-weight: 700; color: white; margin-top: 2px; }

        /* --- UX: CONTROLS --- */
        .controls { display: flex; gap: 10px; margin-top: 15px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .pill-btn { 
            background: var(--bg-card); border: 1px solid rgba(255,255,255,0.1); 
            color: var(--text-muted); padding: 6px 14px; border-radius: 20px; 
            font-size: 0.7rem; font-weight: 600; white-space: nowrap; transition: 0.2s;
        }
        .pill-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- UI: CALENDAR GRID --- */
        .scroll-content { padding-top: 220px; padding-bottom: 100px; padding-left: 12px; padding-right: 12px; max-width: 800px; margin: 0 auto; }
        
        .month-section { margin-bottom: 30px; }
        .month-title { 
            font-size: 0.9rem; font-weight: 800; color: var(--text-muted); margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;
        }
        .month-stats { font-family: var(--font-data); font-size: 0.7rem; color: var(--primary); }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-header { text-align: center; font-size: 0.6rem; color: #444; font-weight: 700; margin-bottom: 5px; }

        .day-card {
            background: var(--bg-card);
            border-radius: 8px;
            aspect-ratio: 0.8; /* Mantiene proporción vertical */
            position: relative;
            cursor: pointer;
            border: 1px solid transparent;
            transition: transform 0.1s, background 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .day-card:active { transform: scale(0.95); }
        
        /* ESTADOS CRÍTICOS */
        .day-card.today { 
            border: 1px solid var(--primary); 
            background: rgba(255, 61, 0, 0.05);
            box-shadow: 0 0 15px rgba(255, 61, 0, 0.2);
            animation: pulse border 2s infinite;
        }
        
        .day-card.completed { background: #102915; border-color: #1b5e20; }
        .day-card.completed svg { fill: var(--success); }
        .day-card.missed { background: rgba(255, 23, 68, 0.1); }

        .day-num { position: absolute; top: 4px; right: 5px; font-family: var(--font-data); font-size: 0.6rem; color: #555; }
        .day-icon { width: 20px; height: 20px; fill: #555; margin-bottom: 4px; }
        .day-label { font-size: 0.55rem; color: #888; text-transform: uppercase; font-weight: 700; display: none; } /* Oculto en grid para limpieza visual */
        
        /* Indicador de Nota */
        .has-note::after { content:''; position: absolute; bottom: 4px; width: 4px; height: 4px; background: white; border-radius: 50%; }

        /* --- MODAL: MISSION BRIEFING --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; justify-content: center; align-items: end; }
        .modal-card { 
            background: #1a1a1a; width: 100%; max-width: 500px; 
            border-top-left-radius: 20px; border-top-right-radius: 20px; 
            padding: 25px; border-top: 1px solid #333; 
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-date { font-family: var(--font-data); color: var(--text-muted); font-size: 0.8rem; }
        .modal-title { font-size: 1.5rem; font-weight: 800; margin: 0; line-height: 1.1; color: white; }
        
        .coach-block { background: rgba(255, 61, 0, 0.1); border-left: 3px solid var(--primary); padding: 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
        .coach-label { color: var(--primary); font-size: 0.7rem; font-weight: 800; letter-spacing: 1px; display: block; margin-bottom: 5px; }
        .coach-text { color: #ddd; font-size: 0.9rem; line-height: 1.4; font-style: italic; }

        textarea { width: 100%; background: #000; border: 1px solid #333; color: white; padding: 15px; border-radius: 8px; font-family: sans-serif; resize: none; height: 80px; margin-bottom: 15px; }
        textarea:focus { outline: none; border-color: var(--primary); }

        .btn-main { width: 100%; background: var(--text-main); color: black; border: none; padding: 18px; font-weight: 800; font-size: 1rem; border-radius: 12px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .btn-main.completed-state { background: #1b5e20; color: var(--success); border: 1px solid var(--success); }

        @media (min-width: 600px) {
            .modal-overlay { align-items: center; }
            .modal-card { border-radius: 20px; }
            .day-card { aspect-ratio: 1; }
            .day-label { display: block; }
        }
    </style>
</head>
<body>

    <svg style="display:none">
        <defs>
            <symbol id="icon-gym" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 5.57 2 7.71 3.43 9.14 2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22 14.86 20.57 16.29 22 18.43 19.86 19.86 18.43 22 16.29z"/></symbol>
            <symbol id="icon-cardio" viewBox="0 0 24 24"><path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7"/></symbol>
            <symbol id="icon-mount" viewBox="0 0 24 24"><path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"/></symbol>
            <symbol id="icon-rest" viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></symbol>
            <symbol id="icon-core" viewBox="0 0 24 24"><path d="M20.5,11H3.5C2.67,11,2,11.67,2,12.5v0c0,0.83,0.67,1.5,1.5,1.5h17c0.83,0,1.5-0.67,1.5-1.5v0 C22,11.67,21.33,11,20.5,11z M12,6c-1.66,0-3,1.34-3,3s1.34,3,3,3s3-1.34,3-3S13.66,6,12,6z M12,16c-2.33,0-7,1.17-7,3.5V21h14 v-1.5C19,17.17,14.33,16,12,16z"/></symbol>
        </defs>
    </svg>

    <div class="sticky-wrapper">
        <div class="header-top">
            <div class="brand">
                <svg viewBox="0 0 24 24"><use href="#icon-mount"></use></svg>
                <h1>PATAGONIA <span>26</span></h1>
            </div>
            <div class="settings-btn" onclick="exportData()">
                <svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-labels">
                <span>CONSISTENCIA</span>
                <span id="progressText">0%</span>
            </div>
            <div class="progress-bar-bg">
                <div id="mainProgressBar" class="progress-bar-fill"></div>
            </div>
        </div>

        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-label">Restantes</div>
                <div class="stat-value" id="statDays">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Sesiones</div>
                <div class="stat-value" id="statSessions">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Fase</div>
                <div class="stat-value" style="color:var(--primary)">BASE</div>
            </div>
        </div>

        <div class="controls">
            <button class="pill-btn active" onclick="filterBy('all', this)">TODO</button>
            <button class="pill-btn" onclick="filterBy('cerro', this)">MONTAÑA</button>
            <button class="pill-btn" onclick="filterBy('gym', this)">FUERZA</button>
            <button class="pill-btn" onclick="filterBy('cardio', this)">CARDIO</button>
        </div>
    </div>

    <div id="calendarContainer" class="scroll-content">
        </div>

    <div id="modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-date" id="mDate">LUN 19 ENE</span>
                <div id="mIcon" style="width:30px; height:30px; fill:var(--primary)"></div>
            </div>
            <h2 class="modal-title" id="mTitle">ACTIVIDAD</h2>
            <p style="color:#888; margin-top:5px;" id="mDesc">Descripción técnica</p>
            
            <div class="coach-block">
                <span class="coach-label">COACH DICE:</span>
                <span class="coach-text" id="mNote">Instrucción clave.</span>
            </div>

            <textarea id="mInput" placeholder="Bitácora: Peso usado, dolor, sensación..."></textarea>
            
            <button id="mBtn" class="btn-main" onclick="toggleStatus()">MARCAR COMPLETADO</button>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN & DATA ---
        // INICIO: 19 Enero 2026. FIN: 1 Noviembre 2026.
        const CONFIG = {
            start: new Date(2026, 0, 19), 
            end: new Date(2026, 10, 1),
            storageKey: 'patagonia_v8_titanium'
        };

        // Estado Global
        let store = JSON.parse(localStorage.getItem(CONFIG.storageKey)) || {};
        let currentFilter = 'all';
        let selectedDateKey = null;

        // Rutinas adaptadas para "Catch Up" (Recuperar tiempo perdido)
        const ROUTINES = {
            1: { type: 'core', icon: '#icon-core', title: 'CORE & ACTIVACIÓN', desc: '40min. Planchas, Deadbugs y movilidad de cadera.', note: 'Es Lunes. Marca la pauta. Si tu core falla, tu espalda falla en la montaña.' },
            2: { type: 'cardio', icon: '#icon-cardio', title: 'ZONA 2 CONSTANTE', desc: '50min Trote o Bici ritmo conversacional.', note: 'Aburrido pero efectivo. Construye capilares. No pases del 70% HR.' },
            3: { type: 'gym', icon: '#icon-gym', title: 'FUERZA TREN INFERIOR', desc: 'Sentadilla, Peso Muerto, Zancadas. 4x10.', note: 'Hoy duelen las piernas. Carga peso real. No venimos a jugar.' },
            4: { type: 'cardio', icon: '#icon-cardio', title: 'INTERVALOS VO2', desc: '30min: 2min fuerte / 2min suave.', note: 'Acostúmbrate a la falta de aire. Así se siente la altura.' },
            5: { type: 'rest', icon: '#icon-rest', title: 'DESCANSO ACTIVO', desc: 'Caminata 30min + Estiramiento.', note: 'Come bien. Duerme 8h. El músculo crece hoy, no en el gym.' },
            6: { type: 'cerro', icon: '#icon-mount', title: 'SALIDA TÉCNICA', desc: 'Ruta con desnivel. Botas puestas.', note: 'Prueba tu equipo. Ajusta la mochila. Siente el terreno.' },
            0: { type: 'cerro', icon: '#icon-mount', title: 'VOLUMEN EXTRA', desc: 'Caminata larga o Bici suave.', note: 'Día para sumar kilómetros sin estrés. Disfruta.' }
        };

        // --- CORE FUNCTIONS ---

        function init() {
            renderCalendar();
            updateDashboard();
            scrollToToday();
        }

        function getDates() {
            let dates = [];
            let curr = new Date(CONFIG.start);
            while (curr <= CONFIG.end) {
                dates.push(new Date(curr));
                curr.setDate(curr.getDate() + 1);
            }
            return dates;
        }

        function formatDateKey(date) {
            // Formato YYYY-MM-DD local
            const offset = date.getTimezoneOffset();
            const local = new Date(date.getTime() - (offset * 60 * 1000));
            return local.toISOString().split('T')[0];
        }

        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';
            
            const allDates = getDates();
            const todayKey = formatDateKey(new Date());

            let currentMonth = -1;
            let monthWrapper = null;
            let grid = null;

            allDates.forEach(date => {
                // Lógica de Meses
                if (date.getMonth() !== currentMonth) {
                    currentMonth = date.getMonth();
                    
                    monthWrapper = document.createElement('div');
                    monthWrapper.className = 'month-section';
                    
                    const title = document.createElement('div');
                    title.className = 'month-title';
                    title.innerHTML = `<span>${date.toLocaleDateString('es-MX', {month:'long'}).toUpperCase()}</span>`;
                    monthWrapper.appendChild(title);

                    // Headers de días (L M M J V S D)
                    if (currentFilter === 'all') {
                        const headers = document.createElement('div');
                        headers.className = 'calendar-grid';
                        ['L','M','M','J','V','S','D'].forEach(d => {
                            headers.innerHTML += `<div class="day-header">${d}</div>`;
                        });
                        monthWrapper.appendChild(headers);
                    }

                    grid = document.createElement('div');
                    grid.className = 'calendar-grid';
                    monthWrapper.appendChild(grid);
                    container.appendChild(monthWrapper);

                    // Espaciadores para empezar en el día correcto de la semana
                    if (currentFilter === 'all') {
                        let day = date.getDay();
                        let emptySlots = day === 0 ? 6 : day - 1;
                        for(let i=0; i<emptySlots; i++) grid.innerHTML += `<div></div>`;
                    }
                }

                // Render Día
                const dayOfWeek = date.getDay();
                const routine = ROUTINES[dayOfWeek];
                const key = formatDateKey(date);
                const data = store[key];

                // Filtro
                if (currentFilter !== 'all' && routine.type !== currentFilter) return;

                const el = document.createElement('div');
                el.className = 'day-card';
                if (key === todayKey) el.classList.add('today');
                if (data && data.completed) el.classList.add('completed');
                if (data && data.note) el.classList.add('has-note');

                el.onclick = () => openModal(date, routine, key);

                el.innerHTML = `
                    <span class="day-num">${date.getDate()}</span>
                    <svg class="day-icon"><use href="${routine.icon}"></use></svg>
                    <span class="day-label">${routine.type}</span>
                `;
                grid.appendChild(el);
            });
        }

        // --- DASHBOARD LOGIC ---
        function updateDashboard() {
            const today = new Date(); today.setHours(0,0,0,0);
            const diffTime = Math.abs(CONFIG.end - today);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            
            const totalDays = getDates().length;
            const completed = Object.keys(store).length;
            const percentage = Math.round((completed / totalDays) * 100); // Un poco trampa (vs días pasados) pero motivador

            document.getElementById('statDays').innerText = diffDays;
            document.getElementById('statSessions').innerText = completed;
            document.getElementById('progressText').innerText = percentage + "%";
            document.getElementById('mainProgressBar').style.width = percentage + "%";
        }

        // --- INTERACTIONS ---
        function filterBy(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderCalendar();
        }

        function scrollToToday() {
            setTimeout(() => {
                const todayEl = document.querySelector('.today');
                if (todayEl) todayEl.scrollIntoView({behavior: 'smooth', block: 'center'});
            }, 300);
        }

        // --- MODAL LOGIC ---
        function openModal(date, routine, key) {
            selectedDateKey = key;
            const data = store[key];
            const modal = document.getElementById('modal');
            
            document.getElementById('mDate').innerText = date.toLocaleDateString('es-MX', {weekday:'short', day:'numeric', month:'short'}).toUpperCase();
            document.getElementById('mTitle').innerText = routine.title;
            document.getElementById('mDesc').innerText = routine.desc;
            document.getElementById('mNote').innerText = routine.note;
            document.getElementById('mIcon').innerHTML = `<svg style="width:100%;height:100%;fill:inherit"><use href="${routine.icon}"></use></svg>`;
            
            const input = document.getElementById('mInput');
            const btn = document.getElementById('mBtn');

            input.value = data ? (data.note || '') : '';
            
            if (data && data.completed) {
                btn.innerText = "DESMARCAR (UNDO)";
                btn.classList.add('completed-state');
                btn.style.background = '#333';
            } else {
                btn.innerText = "MARCAR COMPLETADO";
                btn.classList.remove('completed-state');
                btn.style.background = '#E0E0E0';
            }

            modal.style.display = 'flex';
        }

        function closeModal(e) {
            if (e && e.target.id !== 'modal') return;
            document.getElementById('modal').style.display = 'none';
        }

        function toggleStatus() {
            const note = document.getElementById('mInput').value;
            
            if (store[selectedDateKey] && store[selectedDateKey].completed) {
                delete store[selectedDateKey];
            } else {
                store[selectedDateKey] = { completed: true, note: note };
            }
            
            localStorage.setItem(CONFIG.storageKey, JSON.stringify(store));
            
            // Haptic Feedback simulado (Visual)
            const btn = document.getElementById('mBtn');
            btn.innerText = "GUARDANDO...";
            
            setTimeout(() => {
                document.getElementById('modal').style.display = 'none';
                renderCalendar();
                updateDashboard();
            }, 200);
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(store));
            const anchor = document.createElement('a');
            anchor.setAttribute("href", dataStr);
            anchor.setAttribute("download", "patagonia_data.json");
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
            alert("Datos exportados. Guarda este archivo.");
        }

        // AUTO-INIT
        init();

    </script>
</body>
</html>
